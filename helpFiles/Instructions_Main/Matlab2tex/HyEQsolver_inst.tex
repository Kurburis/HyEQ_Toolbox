% This file was automatically created from the m-file 
% "m2tex.m" written by USL. 
% The fontencoding in this file is UTF-8. 
%  
% You will need to include the following two packages in 
% your LaTeX-Main-File. 
%  
% \usepackage{color} 
% \usepackage{fancyvrb} 
%  
% It is advised to use the following option for Inputenc 
% \usepackage[utf8]{inputenc} 
%  
  
% definition of matlab colors: 
\definecolor{mblue}{rgb}{0,0,1} 
\definecolor{mgreen}{rgb}{0.13333,0.5451,0.13333} 
\definecolor{mred}{rgb}{0.62745,0.12549,0.94118} 
\definecolor{mgrey}{rgb}{0.5,0.5,0.5} 
\definecolor{mdarkgrey}{rgb}{0.25,0.25,0.25} 
  
\DefineShortVerb[fontfamily=courier,fontseries=m]{\$} 
\DefineShortVerb[fontfamily=courier,fontseries=b]{\#} 
  
\noindent                                                                                                                                                                                                                                                                             \hspace*{-1.6em}{\scriptsize 1}$  $\color{mblue}$function$\color{black}$ [t j x] = HyEQsolver(f,g,C,D,x0,TSPAN,JSPAN,rule,options,solver,E)$\\ \hspace*{-1.6em}{\scriptsize 2}$  $\color{mgreen}$%HYEQSOLVER solves hybrid equations.$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 3}$  $\color{mgreen}$%   Syntax: [t j x] = HYEQSOLVER(f,g,C,D,x0,TSPAN,JSPAN,rule,options,solver,E)$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 4}$  $\color{mgreen}$%   computes solutions to the hybrid equations$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 5}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 6}$  $\color{mgreen}$%   \dot{x} = f(x,t,j)  x \in C x^+ = g(x,t,j)  x \in D$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 7}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 8}$  $\color{mgreen}$%   where x is the state, f is the flow map, g is the jump map, C is the$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 9}$  $\color{mgreen}$%   flow set, and D is the jump set. It outputs the state trajectory (t,j)$\color{black}$$\\ \hspace*{-2em}{\scriptsize 10}$  $\color{mgreen}$%   -> x(t,j), where t is the flow time parameter and j is the jump$\color{black}$$\\ \hspace*{-2em}{\scriptsize 11}$  $\color{mgreen}$%   parameter.$\color{black}$$\\ \hspace*{-2em}{\scriptsize 12}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 13}$  $\color{mgreen}$%   x0 defines the initial condition for the state.$\color{black}$$\\ \hspace*{-2em}{\scriptsize 14}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 15}$  $\color{mgreen}$%   TSPAN = [TSTART TFINAL] is the time interval. JSPAN = [JSTART JSTOP] is$\color{black}$$\\ \hspace*{-2em}{\scriptsize 16}$  $\color{mgreen}$%       the interval for discrete jumps. The algorithm stop when the first$\color{black}$$\\ \hspace*{-2em}{\scriptsize 17}$  $\color{mgreen}$%       stop condition is reached.$\color{black}$$\\ \hspace*{-2em}{\scriptsize 18}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 19}$  $\color{mgreen}$%   rule (optional parameter) - rule for jumps$\color{black}$$\\ \hspace*{-2em}{\scriptsize 20}$  $\color{mgreen}$%       rule = 1 (default) -> priority for jumps rule = 2 -> priority for$\color{black}$$\\ \hspace*{-2em}{\scriptsize 21}$  $\color{mgreen}$%       flows$\color{black}$$\\ \hspace*{-2em}{\scriptsize 22}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 23}$  $\color{mgreen}$%   options (optional parameter) - options for the solver see odeset f.ex.$\color{black}$$\\ \hspace*{-2em}{\scriptsize 24}$  $\color{mgreen}$%       options = odeset('RelTol',1e-6);$\color{black}$$\\ \hspace*{-2em}{\scriptsize 25}$  $\color{mgreen}$%       options = odeset('InitialStep',eps);$\color{black}$$\\ \hspace*{-2em}{\scriptsize 26}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 27}$  $\color{mgreen}$%   solver (optional parameter. String) - selection of the desired ode$\color{black}$$\\ \hspace*{-2em}{\scriptsize 28}$  $\color{mgreen}$%       solver. All ode solvers are suported, exept for ode15i.  See help$\color{black}$$\\ \hspace*{-2em}{\scriptsize 29}$  $\color{mgreen}$%       odeset for detailed information.$\color{black}$$\\ \hspace*{-2em}{\scriptsize 30}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 31}$  $\color{mgreen}$%   E (optional parameter) - Mass matrix [constant matrix | function_handle]$\color{black}$$\\ \hspace*{-2em}{\scriptsize 32}$  $\color{mgreen}$%       For problems: $\color{black}$$\\ \hspace*{-2em}{\scriptsize 33}$  $\color{mgreen}$%       E*\dot{x} = f(x) x \in C $\color{black}$$\\ \hspace*{-2em}{\scriptsize 34}$  $\color{mgreen}$%       x^+ = g(x)  x \in D$\color{black}$$\\ \hspace*{-2em}{\scriptsize 35}$  $\color{mgreen}$%       set this property to the value of the constant mass matrix. For$\color{black}$$\\ \hspace*{-2em}{\scriptsize 36}$  $\color{mgreen}$%       problems with time- or state-dependent mass matrices, set this$\color{black}$$\\ \hspace*{-2em}{\scriptsize 37}$  $\color{mgreen}$%       property to a function that evaluates the mass matrix. See help$\color{black}$$\\ \hspace*{-2em}{\scriptsize 38}$  $\color{mgreen}$%       odeset for detailed information.$\color{black}$$\\ \hspace*{-2em}{\scriptsize 39}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 40}$  $\color{mgreen}$%         Example: Bouncing ball with Lite HyEQ Solver$\color{black}$$\\ \hspace*{-2em}{\scriptsize 41}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 42}$  $\color{mgreen}$%         % Consider the hybrid system model for the bouncing ball with data given in$\color{black}$$\\ \hspace*{-2em}{\scriptsize 43}$  $\color{mgreen}$%         % Example 1.2. For this example, we consider the ball to be bouncing on a$\color{black}$$\\ \hspace*{-2em}{\scriptsize 44}$  $\color{mgreen}$%         % floor at zero height. The constants for the bouncing ball system are$\color{black}$$\\ \hspace*{-2em}{\scriptsize 45}$  $\color{mgreen}$%         % \gamma=9.81 and \lambda=0.8. The following procedure is used to$\color{black}$$\\ \hspace*{-2em}{\scriptsize 46}$  $\color{mgreen}$%         % simulate this example in the Lite HyEQ Solver:$\color{black}$$\\ \hspace*{-2em}{\scriptsize 47}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 48}$  $\color{mgreen}$%         % * Inside the MATLAB script run_ex1_2.m, initial conditions, simulation$\color{black}$$\\ \hspace*{-2em}{\scriptsize 49}$  $\color{mgreen}$%         % horizons, a rule for jumps, ode solver options, and a step size$\color{black}$$\\ \hspace*{-2em}{\scriptsize 50}$  $\color{mgreen}$%         % coefficient are defined. The function HYEQSOLVER.m is called in order to$\color{black}$$\\ \hspace*{-2em}{\scriptsize 51}$  $\color{mgreen}$%         % run the simulation, and a script for plotting solutions is included.$\color{black}$$\\ \hspace*{-2em}{\scriptsize 52}$  $\color{mgreen}$%         % * Then the MATLAB functions f_ex1_2.m, C_ex1_2.m, g_ex1_2.m, D_ex1_2.m$\color{black}$$\\ \hspace*{-2em}{\scriptsize 53}$  $\color{mgreen}$%         % are edited according to the data given below.$\color{black}$$\\ \hspace*{-2em}{\scriptsize 54}$  $\color{mgreen}$%         % * Finally, the simulation is run by clicking the run button in$\color{black}$$\\ \hspace*{-2em}{\scriptsize 55}$  $\color{mgreen}$%         % run_ex1_2.m or by calling run_ex1_2.m in the MATLAB command window.$\color{black}$$\\ \hspace*{-2em}{\scriptsize 56}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 57}$  $\color{mgreen}$%         % For further information, type in the command window:$\color{black}$$\\ \hspace*{-2em}{\scriptsize 58}$  $\color{mgreen}$%         web(['Example_1_2.html']);$\color{black}$$\\ \hspace*{-2em}{\scriptsize 59}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 60}$  $\color{mgreen}$%         % Define initial conditions$\color{black}$$\\ \hspace*{-2em}{\scriptsize 61}$  $\color{mgreen}$%         x1_0 = 1;$\color{black}$$\\ \hspace*{-2em}{\scriptsize 62}$  $\color{mgreen}$%         x2_0 = 0;$\color{black}$$\\ \hspace*{-2em}{\scriptsize 63}$  $\color{mgreen}$%         x0   = [x1_0; x2_0];$\color{black}$$\\ \hspace*{-2em}{\scriptsize 64}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 65}$  $\color{mgreen}$%         % Set simulation horizon$\color{black}$$\\ \hspace*{-2em}{\scriptsize 66}$  $\color{mgreen}$%         TSPAN = [0 10];$\color{black}$$\\ \hspace*{-2em}{\scriptsize 67}$  $\color{mgreen}$%         JSPAN = [0 20];$\color{black}$$\\ \hspace*{-2em}{\scriptsize 68}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 69}$  $\color{mgreen}$%         % Set rule for jumps and ODE solver options$\color{black}$$\\ \hspace*{-2em}{\scriptsize 70}$  $\color{mgreen}$%         %$\color{black}$$\\ \hspace*{-2em}{\scriptsize 71}$  $\color{mgreen}$%         % rule = 1 -> priority for jumps$\color{black}$$\\ \hspace*{-2em}{\scriptsize 72}$  $\color{mgreen}$%         %$\color{black}$$\\ \hspace*{-2em}{\scriptsize 73}$  $\color{mgreen}$%         % rule = 2 -> priority for flows$\color{black}$$\\ \hspace*{-2em}{\scriptsize 74}$  $\color{mgreen}$%         %$\color{black}$$\\ \hspace*{-2em}{\scriptsize 75}$  $\color{mgreen}$%         % set the maximum step length. At each run of the$\color{black}$$\\ \hspace*{-2em}{\scriptsize 76}$  $\color{mgreen}$%         % integrator the option 'MaxStep' is set to$\color{black}$$\\ \hspace*{-2em}{\scriptsize 77}$  $\color{mgreen}$%         % (time length of last integration)*maxStepCoefficient.$\color{black}$$\\ \hspace*{-2em}{\scriptsize 78}$  $\color{mgreen}$%         %  Default value = 0.1$\color{black}$$\\ \hspace*{-2em}{\scriptsize 79}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 80}$  $\color{mgreen}$%         rule               = 1;$\color{black}$$\\ \hspace*{-2em}{\scriptsize 81}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 82}$  $\color{mgreen}$%         options            = odeset('RelTol',1e-6,'MaxStep',.1);$\color{black}$$\\ \hspace*{-2em}{\scriptsize 83}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 84}$  $\color{mgreen}$%         % Simulate using the HYEQSOLVER script$\color{black}$$\\ \hspace*{-2em}{\scriptsize 85}$  $\color{mgreen}$%         % Given the matlab functions that models the flow map, jump map,$\color{black}$$\\ \hspace*{-2em}{\scriptsize 86}$  $\color{mgreen}$%         % flow set and jump set (f_ex1_2, g_ex1_2, C_ex1_2, and D_ex1_2$\color{black}$$\\ \hspace*{-2em}{\scriptsize 87}$  $\color{mgreen}$%         % respectively)$\color{black}$$\\ \hspace*{-2em}{\scriptsize 88}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 89}$  $\color{mgreen}$%         [t j x] = HYEQSOLVER( @f_ex1_2,@g_ex1_2,@C_ex1_2,@D_ex1_2,...$\color{black}$$\\ \hspace*{-2em}{\scriptsize 90}$  $\color{mgreen}$%             x0,TSPAN,JSPAN,rule,options,'ode45');$\color{black}$$\\ \hspace*{-2em}{\scriptsize 91}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 92}$  $\color{mgreen}$%         % plot solution$\color{black}$$\\ \hspace*{-2em}{\scriptsize 93}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2em}{\scriptsize 94}$  $\color{mgreen}$%         figure(1) % position$\color{black}$$\\ \hspace*{-2em}{\scriptsize 95}$  $\color{mgreen}$%         clf$\color{black}$$\\ \hspace*{-2em}{\scriptsize 96}$  $\color{mgreen}$%         subplot(2,1,1),plotflows(t,j,x(:,1))$\color{black}$$\\ \hspace*{-2em}{\scriptsize 97}$  $\color{mgreen}$%         grid on$\color{black}$$\\ \hspace*{-2em}{\scriptsize 98}$  $\color{mgreen}$%         ylabel('x1')$\color{black}$$\\ \hspace*{-2em}{\scriptsize 99}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 100}$  $\color{mgreen}$%         subplot(2,1,2),plotjumps(t,j,x(:,1))$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 101}$  $\color{mgreen}$%         grid on$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 102}$  $\color{mgreen}$%         ylabel('x1')$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 103}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 104}$  $\color{mgreen}$%         figure(2) % velocity$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 105}$  $\color{mgreen}$%         clf$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 106}$  $\color{mgreen}$%         subplot(2,1,1),plotflows(t,j,x(:,2))$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 107}$  $\color{mgreen}$%         grid on$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 108}$  $\color{mgreen}$%         ylabel('x2')$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 109}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 110}$  $\color{mgreen}$%         subplot(2,1,2),plotjumps(t,j,x(:,2))$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 111}$  $\color{mgreen}$%         grid on$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 112}$  $\color{mgreen}$%         ylabel('x2')$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 113}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 114}$  $\color{mgreen}$%         % plot hybrid arc$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 115}$  $\color{mgreen}$%         $\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 116}$  $\color{mgreen}$%         figure(3)$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 117}$  $\color{mgreen}$%         plotHybridArc(t,j,x)$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 118}$  $\color{mgreen}$%         xlabel('j')$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 119}$  $\color{mgreen}$%         ylabel('t')$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 120}$  $\color{mgreen}$%         zlabel('x1')$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 121}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 122}$  $\color{mgreen}$%         % plot solution using plotHarc and plotHarcColor$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 123}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 124}$  $\color{mgreen}$%         figure(4) % position$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 125}$  $\color{mgreen}$%         clf$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 126}$  $\color{mgreen}$%         subplot(2,1,1), plotHarc(t,j,x(:,1));$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 127}$  $\color{mgreen}$%         grid on$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 128}$  $\color{mgreen}$%         ylabel('x_1 position')$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 129}$  $\color{mgreen}$%         subplot(2,1,2), plotHarc(t,j,x(:,2));$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 130}$  $\color{mgreen}$%         grid on$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 131}$  $\color{mgreen}$%         ylabel('x_2 velocity')$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 132}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 133}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 134}$  $\color{mgreen}$%         % plot a phase plane$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 135}$  $\color{mgreen}$%         figure(5) % position$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 136}$  $\color{mgreen}$%         clf$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 137}$  $\color{mgreen}$%         plotHarcColor(x(:,1),j,x(:,2),t);$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 138}$  $\color{mgreen}$%         xlabel('x_1')$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 139}$  $\color{mgreen}$%         ylabel('x_2')$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 140}$  $\color{mgreen}$%         grid on$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 141}$  $\color{mgreen}$%$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 142}$  $\color{mgreen}$%--------------------------------------------------------------------------$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 143}$  $\color{mgreen}$% Matlab M-file Project: HyEQ Toolbox @  Hybrid Systems Laboratory (HSL),$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 144}$  $\color{mgreen}$% https://hybrid.soe.ucsc.edu/software$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 145}$  $\color{mgreen}$% http://hybridsimulator.wordpress.com/$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 146}$  $\color{mgreen}$% Filename: HYEQSOLVER.m$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 147}$  $\color{mgreen}$%--------------------------------------------------------------------------$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 148}$  $\color{mgreen}$%   See also HYEQSOLVER, PLOTARC, PLOTARC3, PLOTFLOWS, PLOTHARC,$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 149}$  $\color{mgreen}$%   PLOTHARCCOLOR, PLOTHARCCOLOR3D, PLOTHYBRIDARC, PLOTJUMPS.$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 150}$  $\color{mgreen}$%   Copyright @ Hybrid Systems Laboratory (HSL),$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 151}$  $\color{mgreen}$%   Revision: 0.0.0.4 Date: 04/6/2017 16:26:00$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 152}$  $\\ \hspace*{-2.4em}{\scriptsize 153}$  $\\ \hspace*{-2.4em}{\scriptsize 154}$  $\color{mblue}$if$\color{black}$ ~exist($\color{mred}$'rule'$\color{black}$,$\color{mred}$'var'$\color{black}$)$\\ \hspace*{-2.4em}{\scriptsize 155}$      rule = 1;$\\ \hspace*{-2.4em}{\scriptsize 156}$  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 157}$  $\\ \hspace*{-2.4em}{\scriptsize 158}$  $\color{mblue}$if$\color{black}$ ~exist($\color{mred}$'options'$\color{black}$,$\color{mred}$'var'$\color{black}$)$\\ \hspace*{-2.4em}{\scriptsize 159}$      options = odeset();$\\ \hspace*{-2.4em}{\scriptsize 160}$  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 161}$  $\color{mblue}$if$\color{black}$ exist($\color{mred}$'E'$\color{black}$,$\color{mred}$$\color{mred}$'var'$\color{black}$$\color{black}$) && ~exist($\color{mred}$'solver'$\color{black}$,$\color{mred}$$\color{mred}$'var'$\color{black}$$\color{black}$)$\\ \hspace*{-2.4em}{\scriptsize 162}$      solver = $\color{mred}$'ode15s'$\color{black}$;$\\ \hspace*{-2.4em}{\scriptsize 163}$  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 164}$  $\color{mblue}$if$\color{black}$ ~exist($\color{mred}$'solver'$\color{black}$,$\color{mred}$'var'$\color{black}$)$\\ \hspace*{-2.4em}{\scriptsize 165}$      solver = $\color{mred}$'ode45'$\color{black}$;$\\ \hspace*{-2.4em}{\scriptsize 166}$  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 167}$  $\color{mblue}$if$\color{black}$ ~exist($\color{mred}$'E'$\color{black}$,$\color{mred}$'var'$\color{black}$)$\\ \hspace*{-2.4em}{\scriptsize 168}$      E = [];$\\ \hspace*{-2.4em}{\scriptsize 169}$  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 170}$  $\color{mgreen}$% mass matrix (if existent)$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 171}$  isDAE = false;$\\ \hspace*{-2.4em}{\scriptsize 172}$  $\color{mblue}$if$\color{black}$ ~isempty(E)$\\ \hspace*{-2.4em}{\scriptsize 173}$      isDAE = true;$\\ \hspace*{-2.4em}{\scriptsize 174}$      $\color{mblue}$switch$\color{black}$ isa(E,$\color{mred}$'function_handle'$\color{black}$)$\\ \hspace*{-2.4em}{\scriptsize 175}$          $\color{mblue}$case$\color{black}$ true $\color{mgreen}$% Function E(x)$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 176}$              M = E;$\\ \hspace*{-2.4em}{\scriptsize 177}$              options = odeset(options,$\color{mred}$'Mass'$\color{black}$,M,$\color{mred}$'Stats'$\color{black}$,$\color{mred}$'off'$\color{black}$,...$\\ \hspace*{-2.4em}{\scriptsize 178}$                  $\color{mred}$'MassSingular'$\color{black}$,$\color{mred}$'maybe'$\color{black}$,$\color{mred}$'MStateDependence'$\color{black}$,$\color{mred}$'strong'$\color{black}$,...$\\ \hspace*{-2.4em}{\scriptsize 179}$                  $\color{mred}$'InitialSlope'$\color{black}$,f_hdae(x0,TSPAN(1))); $\\ \hspace*{-2.4em}{\scriptsize 180}$          $\color{mblue}$case$\color{black}$ false $\color{mgreen}$% Constant double matrix$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 181}$              M = double(E);$\\ \hspace*{-2.4em}{\scriptsize 182}$              options = odeset(options,$\color{mred}$'Mass'$\color{black}$,M,$\color{mred}$'Stats'$\color{black}$,$\color{mred}$'off'$\color{black}$,...$\\ \hspace*{-2.4em}{\scriptsize 183}$                  $\color{mred}$'MassSingular'$\color{black}$,$\color{mred}$'maybe'$\color{black}$,$\color{mred}$'MStateDependence'$\color{black}$,$\color{mred}$'none'$\color{black}$);$\\ \hspace*{-2.4em}{\scriptsize 184}$      $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 185}$  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 186}$  $\\ \hspace*{-2.4em}{\scriptsize 187}$  odeX = str2func(solver);$\\ \hspace*{-2.4em}{\scriptsize 188}$  nargf = nargin(f);$\\ \hspace*{-2.4em}{\scriptsize 189}$  nargg = nargin(g);$\\ \hspace*{-2.4em}{\scriptsize 190}$  nargC = nargin(C);$\\ \hspace*{-2.4em}{\scriptsize 191}$  nargD = nargin(D);$\\ \hspace*{-2.4em}{\scriptsize 192}$  $\\ \hspace*{-2.4em}{\scriptsize 193}$  $\\ \hspace*{-2.4em}{\scriptsize 194}$  $\\ \hspace*{-2.4em}{\scriptsize 195}$  $\color{mgreen}$% simulation horizon$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 196}$  tstart = TSPAN(1);$\\ \hspace*{-2.4em}{\scriptsize 197}$  tfinal = TSPAN(end);$\\ \hspace*{-2.4em}{\scriptsize 198}$  jout = JSPAN(1);$\\ \hspace*{-2.4em}{\scriptsize 199}$  j = jout(end);$\\ \hspace*{-2.4em}{\scriptsize 200}$  $\\ \hspace*{-2.4em}{\scriptsize 201}$  $\color{mgreen}$% simulate$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 202}$  tout = tstart;$\\ \hspace*{-2.4em}{\scriptsize 203}$  [rx,cx] = size(x0);$\\ \hspace*{-2.4em}{\scriptsize 204}$  $\color{mblue}$if$\color{black}$ rx == 1$\\ \hspace*{-2.4em}{\scriptsize 205}$      xout = x0;$\\ \hspace*{-2.4em}{\scriptsize 206}$  $\color{mblue}$elseif$\color{black}$ cx == 1$\\ \hspace*{-2.4em}{\scriptsize 207}$      xout = x0.';$\\ \hspace*{-2.4em}{\scriptsize 208}$  $\color{mblue}$else$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 209}$      error($\color{mred}$'Error, x0 does not have the proper size'$\color{black}$)$\\ \hspace*{-2.4em}{\scriptsize 210}$  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 211}$  $\\ \hspace*{-2.4em}{\scriptsize 212}$  $\color{mgreen}$% Jump if jump is prioritized:$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 213}$  $\color{mblue}$if$\color{black}$ rule == 1$\\ \hspace*{-2.4em}{\scriptsize 214}$      $\color{mblue}$while$\color{black}$ (j<JSPAN(end))$\\ \hspace*{-2.4em}{\scriptsize 215}$          $\color{mgreen}$% Check if value it is possible to jump current position$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 216}$          insideD = fun_wrap(xout(end,:).',tout(end),j,D,nargD);$\\ \hspace*{-2.4em}{\scriptsize 217}$          $\color{mblue}$if$\color{black}$ insideD == 1$\\ \hspace*{-2.4em}{\scriptsize 218}$              [j $\color{mred}$tout jout xout] = jump(g,j,tout,jout,xout,nargg);$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 219}$          $\color{mblue}$else$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 220}$              break;$\\ \hspace*{-2.4em}{\scriptsize 221}$          $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 222}$      $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 223}$  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 224}$  fprintf($\color{mred}$'Completed: %3.0f%%'$\color{black}$,0);$\\ \hspace*{-2.4em}{\scriptsize 225}$  $\color{mblue}$while$\color{black}$ (j < JSPAN(end) && tout(end) < TSPAN(end))$\\ \hspace*{-2.4em}{\scriptsize 226}$      options = odeset(options,$\color{mred}$'Events'$\color{black}$,@(t,x) zeroevents(x,t,j,C,D,...$\\ \hspace*{-2.4em}{\scriptsize 227}$          rule,nargC,nargD));$\\ \hspace*{-2.4em}{\scriptsize 228}$      $\color{mgreen}$% Check if it is possible to flow from current position$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 229}$      insideC = fun_wrap(xout(end,:).',tout(end),j,C,nargC);$\\ \hspace*{-2.4em}{\scriptsize 230}$      $\color{mblue}$if$\color{black}$ insideC == 1$\\ \hspace*{-2.4em}{\scriptsize 231}$          $\color{mblue}$if$\color{black}$ isDAE$\\ \hspace*{-2.4em}{\scriptsize 232}$              options = odeset(options,$\color{mred}$'InitialSlope'$\color{black}$,f(xout(end,:).',tout(end)));$\\ \hspace*{-2.4em}{\scriptsize 233}$          $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 234}$          [t,x] = odeX(@(t,x) fun_wrap(x,t,j,f,nargf),[tout(end) tfinal],...$\\ \hspace*{-2.4em}{\scriptsize 235}$              xout(end,:).', $\color{mred}$options);$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 236}$          nt = length(t);$\\ \hspace*{-2.4em}{\scriptsize 237}$          tout = [tout; t];$\\ \hspace*{-2.4em}{\scriptsize 238}$          xout = [xout; x];$\\ \hspace*{-2.4em}{\scriptsize 239}$          jout = [jout; j*ones(1,nt)'];$\\ \hspace*{-2.4em}{\scriptsize 240}$      $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 241}$      $\\ \hspace*{-2.4em}{\scriptsize 242}$      $\color{mgreen}$%Check if it is possible to jump$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 243}$      insideD = fun_wrap(xout(end,:).',tout(end),j,D,nargD);$\\ \hspace*{-2.4em}{\scriptsize 244}$      $\color{mblue}$if$\color{black}$ insideD == 0$\\ \hspace*{-2.4em}{\scriptsize 245}$          break;$\\ \hspace*{-2.4em}{\scriptsize 246}$      $\color{mblue}$else$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 247}$          $\color{mblue}$if$\color{black}$ rule == 1$\\ \hspace*{-2.4em}{\scriptsize 248}$              $\color{mblue}$while$\color{black}$ (j<JSPAN(end))$\\ \hspace*{-2.4em}{\scriptsize 249}$                  $\color{mgreen}$% Check if it is possible to jump from current position$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 250}$                  insideD = fun_wrap(xout(end,:).',tout(end),j,D,nargD);$\\ \hspace*{-2.4em}{\scriptsize 251}$                  $\color{mblue}$if$\color{black}$ insideD == 1$\\ \hspace*{-2.4em}{\scriptsize 252}$                      [j $\color{mred}$tout jout xout] = jump(g,j,tout,jout,xout,nargg);$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 253}$                  $\color{mblue}$else$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 254}$                      break;$\\ \hspace*{-2.4em}{\scriptsize 255}$                  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 256}$              $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 257}$          $\color{mblue}$else$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 258}$              [j $\color{mred}$tout jout xout] = jump(g,j,tout,jout,xout,nargg);$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 259}$          $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 260}$      $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 261}$      fprintf($\color{mred}$'\b\b\b\b%3.0f%%'$\color{black}$,max(100*j/JSPAN(end),100*tout(end)/TSPAN(end)));$\\ \hspace*{-2.4em}{\scriptsize 262}$  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 263}$  t = tout;$\\ \hspace*{-2.4em}{\scriptsize 264}$  x = xout;$\\ \hspace*{-2.4em}{\scriptsize 265}$  j = jout;$\\ \hspace*{-2.4em}{\scriptsize 266}$  fprintf($\color{mred}$'\nDone\n'$\color{black}$);$\\ \hspace*{-2.4em}{\scriptsize 267}$  $\color{mblue}$end$\color{black}$$\\ \hspace*{-2.4em}{\scriptsize 268}$  $\\ 
  
\UndefineShortVerb{\$} 
\UndefineShortVerb{\#}