% This file was automatically created from the m-file 
% "m2tex.m" written by USL. 
% The fontencoding in this file is UTF-8. 
%  
% You will need to include the following two packages in 
% your LaTeX-Main-File. 
%  
% \usepackage{color} 
% \usepackage{fancyvrb} 
%  
% It is advised to use the following option for Inputenc 
% \usepackage[utf8]{inputenc} 
%  
  
% definition of matlab colors: 
\definecolor{mblue}{rgb}{0,0,1} 
\definecolor{mgreen}{rgb}{0.13333,0.5451,0.13333} 
\definecolor{mred}{rgb}{0.62745,0.12549,0.94118} 
\definecolor{mgrey}{rgb}{0.5,0.5,0.5} 
\definecolor{mdarkgrey}{rgb}{0.25,0.25,0.25} 
  
\DefineShortVerb[fontfamily=courier,fontseries=m]{\$} 
\DefineShortVerb[fontfamily=courier,fontseries=b]{\#} 
  
\begin{Verbatim}[commandchars=\$\{\},numbers=left,numbersep=2pt] 
    $textcolor{mblue}{function} [t j x] = HyEQsolver(f,g,C,D,x0,TSPAN,JSPAN,rule,options,solver,E)     $textcolor{mgreen}{%HYEQSOLVER solves hybrid equations.}     $textcolor{mgreen}{%   Syntax: [t j x] = HYEQSOLVER(f,g,C,D,x0,TSPAN,JSPAN,rule,options,solver,E)}     $textcolor{mgreen}{%   computes solutions to the hybrid equations}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%   \dot{x} = f(x,t,j)  x \in C x^+ = g(x,t,j)  x \in D}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%   where x is the state, f is the flow map, g is the jump map, C is the}     $textcolor{mgreen}{%   flow set, and D is the jump set. It outputs the state trajectory (t,j)}     $textcolor{mgreen}{%   -> x(t,j), where t is the flow time parameter and j is the jump}     $textcolor{mgreen}{%   parameter.}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%   x0 defines the initial condition for the state.}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%   TSPAN = [TSTART TFINAL] is the time interval. JSPAN = [JSTART JSTOP] is}     $textcolor{mgreen}{%       the interval for discrete jumps. The algorithm stop when the first}     $textcolor{mgreen}{%       stop condition is reached.}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%   rule (optional parameter) - rule for jumps}     $textcolor{mgreen}{%       rule = 1 (default) -> priority for jumps rule = 2 -> priority for}     $textcolor{mgreen}{%       flows}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%   options (optional parameter) - options for the solver see odeset f.ex.}     $textcolor{mgreen}{%       options = odeset('RelTol',1e-6);}     $textcolor{mgreen}{%       options = odeset('InitialStep',eps);}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%   solver (optional parameter. String) - selection of the desired ode}     $textcolor{mgreen}{%       solver. All ode solvers are suported, exept for ode15i.  See help}     $textcolor{mgreen}{%       odeset for detailed information.}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%   E (optional parameter) - Mass matrix [constant matrix | function_handle]}     $textcolor{mgreen}{%       For problems: }     $textcolor{mgreen}{%       E*\dot{x} = f(x) x \in C }     $textcolor{mgreen}{%       x^+ = g(x)  x \in D}     $textcolor{mgreen}{%       set this property to the value of the constant mass matrix. For}     $textcolor{mgreen}{%       problems with time- or state-dependent mass matrices, set this}     $textcolor{mgreen}{%       property to a function that evaluates the mass matrix. See help}     $textcolor{mgreen}{%       odeset for detailed information.}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         Example: Bouncing ball with Lite HyEQ Solver}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % Consider the hybrid system model for the bouncing ball with data given in}     $textcolor{mgreen}{%         % Example 1.2. For this example, we consider the ball to be bouncing on a}     $textcolor{mgreen}{%         % floor at zero height. The constants for the bouncing ball system are}     $textcolor{mgreen}{%         % \gamma=9.81 and \lambda=0.8. The following procedure is used to}     $textcolor{mgreen}{%         % simulate this example in the Lite HyEQ Solver:}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % * Inside the MATLAB script run_ex1_2.m, initial conditions, simulation}     $textcolor{mgreen}{%         % horizons, a rule for jumps, ode solver options, and a step size}     $textcolor{mgreen}{%         % coefficient are defined. The function HYEQSOLVER.m is called in order to}     $textcolor{mgreen}{%         % run the simulation, and a script for plotting solutions is included.}     $textcolor{mgreen}{%         % * Then the MATLAB functions f_ex1_2.m, C_ex1_2.m, g_ex1_2.m, D_ex1_2.m}     $textcolor{mgreen}{%         % are edited according to the data given below.}     $textcolor{mgreen}{%         % * Finally, the simulation is run by clicking the run button in}     $textcolor{mgreen}{%         % run_ex1_2.m or by calling run_ex1_2.m in the MATLAB command window.}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % For further information, type in the command window:}     $textcolor{mgreen}{%         web(['Example_1_2.html']);}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % Define initial conditions}     $textcolor{mgreen}{%         x1_0 = 1;}     $textcolor{mgreen}{%         x2_0 = 0;}     $textcolor{mgreen}{%         x0   = [x1_0; x2_0];}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % Set simulation horizon}     $textcolor{mgreen}{%         TSPAN = [0 10];}     $textcolor{mgreen}{%         JSPAN = [0 20];}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % Set rule for jumps and ODE solver options}     $textcolor{mgreen}{%         %}     $textcolor{mgreen}{%         % rule = 1 -> priority for jumps}     $textcolor{mgreen}{%         %}     $textcolor{mgreen}{%         % rule = 2 -> priority for flows}     $textcolor{mgreen}{%         %}     $textcolor{mgreen}{%         % set the maximum step length. At each run of the}     $textcolor{mgreen}{%         % integrator the option 'MaxStep' is set to}     $textcolor{mgreen}{%         % (time length of last integration)*maxStepCoefficient.}     $textcolor{mgreen}{%         %  Default value = 0.1}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         rule               = 1;}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         options            = odeset('RelTol',1e-6,'MaxStep',.1);}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % Simulate using the HYEQSOLVER script}     $textcolor{mgreen}{%         % Given the matlab functions that models the flow map, jump map,}     $textcolor{mgreen}{%         % flow set and jump set (f_ex1_2, g_ex1_2, C_ex1_2, and D_ex1_2}     $textcolor{mgreen}{%         % respectively)}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         [t j x] = HYEQSOLVER( @f_ex1_2,@g_ex1_2,@C_ex1_2,@D_ex1_2,...}     $textcolor{mgreen}{%             x0,TSPAN,JSPAN,rule,options,'ode45');}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % plot solution}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         figure(1) % position}     $textcolor{mgreen}{%         clf}     $textcolor{mgreen}{%         subplot(2,1,1),plotflows(t,j,x(:,1))}     $textcolor{mgreen}{%         grid on}     $textcolor{mgreen}{%         ylabel('x1')}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         subplot(2,1,2),plotjumps(t,j,x(:,1))}     $textcolor{mgreen}{%         grid on}     $textcolor{mgreen}{%         ylabel('x1')}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         figure(2) % velocity}     $textcolor{mgreen}{%         clf}     $textcolor{mgreen}{%         subplot(2,1,1),plotflows(t,j,x(:,2))}     $textcolor{mgreen}{%         grid on}     $textcolor{mgreen}{%         ylabel('x2')}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         subplot(2,1,2),plotjumps(t,j,x(:,2))}     $textcolor{mgreen}{%         grid on}     $textcolor{mgreen}{%         ylabel('x2')}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % plot hybrid arc}     $textcolor{mgreen}{%         }     $textcolor{mgreen}{%         figure(3)}     $textcolor{mgreen}{%         plotHybridArc(t,j,x)}     $textcolor{mgreen}{%         xlabel('j')}     $textcolor{mgreen}{%         ylabel('t')}     $textcolor{mgreen}{%         zlabel('x1')}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % plot solution using plotHarc and plotHarcColor}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         figure(4) % position}     $textcolor{mgreen}{%         clf}     $textcolor{mgreen}{%         subplot(2,1,1), plotHarc(t,j,x(:,1));}     $textcolor{mgreen}{%         grid on}     $textcolor{mgreen}{%         ylabel('x_1 position')}     $textcolor{mgreen}{%         subplot(2,1,2), plotHarc(t,j,x(:,2));}     $textcolor{mgreen}{%         grid on}     $textcolor{mgreen}{%         ylabel('x_2 velocity')}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%         % plot a phase plane}     $textcolor{mgreen}{%         figure(5) % position}     $textcolor{mgreen}{%         clf}     $textcolor{mgreen}{%         plotHarcColor(x(:,1),j,x(:,2),t);}     $textcolor{mgreen}{%         xlabel('x_1')}     $textcolor{mgreen}{%         ylabel('x_2')}     $textcolor{mgreen}{%         grid on}     $textcolor{mgreen}{%}     $textcolor{mgreen}{%--------------------------------------------------------------------------}     $textcolor{mgreen}{% Matlab M-file Project: HyEQ Toolbox @  Hybrid Systems Laboratory (HSL),}     $textcolor{mgreen}{% https://hybrid.soe.ucsc.edu/software}     $textcolor{mgreen}{% http://hybridsimulator.wordpress.com/}     $textcolor{mgreen}{% Filename: HYEQSOLVER.m}     $textcolor{mgreen}{%--------------------------------------------------------------------------}     $textcolor{mgreen}{%   See also HYEQSOLVER, PLOTARC, PLOTARC3, PLOTFLOWS, PLOTHARC,}     $textcolor{mgreen}{%   PLOTHARCCOLOR, PLOTHARCCOLOR3D, PLOTHYBRIDARC, PLOTJUMPS.}     $textcolor{mgreen}{%   Copyright @ Hybrid Systems Laboratory (HSL),}     $textcolor{mgreen}{%   Revision: 0.0.0.4 Date: 04/6/2017 16:26:00}               $textcolor{mblue}{if} ~exist($textcolor{mred}{'rule'},$textcolor{mred}{'var'})         rule = 1;     $textcolor{mblue}{end}          $textcolor{mblue}{if} ~exist($textcolor{mred}{'options'},$textcolor{mred}{'var'})         options = odeset();     $textcolor{mblue}{end}     $textcolor{mblue}{if} exist($textcolor{mred}{'E'},$textcolor{mred}{$textcolor{mred}{'var'}}) && ~exist($textcolor{mred}{'solver'},$textcolor{mred}{$textcolor{mred}{'var'}})         solver = $textcolor{mred}{'ode15s'};     $textcolor{mblue}{end}     $textcolor{mblue}{if} ~exist($textcolor{mred}{'solver'},$textcolor{mred}{'var'})         solver = $textcolor{mred}{'ode45'};     $textcolor{mblue}{end}     $textcolor{mblue}{if} ~exist($textcolor{mred}{'E'},$textcolor{mred}{'var'})         E = [];     $textcolor{mblue}{end}     $textcolor{mgreen}{% mass matrix (if existent)}     isDAE = false;     $textcolor{mblue}{if} ~isempty(E)         isDAE = true;         $textcolor{mblue}{switch} isa(E,$textcolor{mred}{'function_handle'})             $textcolor{mblue}{case} true $textcolor{mgreen}{% Function E(x)}                 M = E;                 options = odeset(options,$textcolor{mred}{'Mass'},M,$textcolor{mred}{'Stats'},$textcolor{mred}{'off'},...                     $textcolor{mred}{'MassSingular'},$textcolor{mred}{'maybe'},$textcolor{mred}{'MStateDependence'},$textcolor{mred}{'strong'},...                     $textcolor{mred}{'InitialSlope'},f_hdae(x0,TSPAN(1)));              $textcolor{mblue}{case} false $textcolor{mgreen}{% Constant double matrix}                 M = double(E);                 options = odeset(options,$textcolor{mred}{'Mass'},M,$textcolor{mred}{'Stats'},$textcolor{mred}{'off'},...                     $textcolor{mred}{'MassSingular'},$textcolor{mred}{'maybe'},$textcolor{mred}{'MStateDependence'},$textcolor{mred}{'none'});         $textcolor{mblue}{end}     $textcolor{mblue}{end}          odeX = str2func(solver);     nargf = nargin(f);     nargg = nargin(g);     nargC = nargin(C);     nargD = nargin(D);                    $textcolor{mgreen}{% simulation horizon}     tstart = TSPAN(1);     tfinal = TSPAN(end);     jout = JSPAN(1);     j = jout(end);          $textcolor{mgreen}{% simulate}     tout = tstart;     [rx,cx] = size(x0);     $textcolor{mblue}{if} rx == 1         xout = x0;     $textcolor{mblue}{elseif} cx == 1         xout = x0.';     $textcolor{mblue}{else}         error($textcolor{mred}{'Error, x0 does not have the proper size'})     $textcolor{mblue}{end}          $textcolor{mgreen}{% Jump if jump is prioritized:}     $textcolor{mblue}{if} rule == 1         $textcolor{mblue}{while} (j<JSPAN(end))             $textcolor{mgreen}{% Check if value it is possible to jump current position}             insideD = fun_wrap(xout(end,:).',tout(end),j,D,nargD);             $textcolor{mblue}{if} insideD == 1                 [j $textcolor{mred}{tout jout xout] = jump(g,j,tout,jout,xout,nargg);}             $textcolor{mblue}{else}                 break;             $textcolor{mblue}{end}         $textcolor{mblue}{end}     $textcolor{mblue}{end}     fprintf($textcolor{mred}{'Completed: %3.0f%%'},0);     $textcolor{mblue}{while} (j < JSPAN(end) && tout(end) < TSPAN(end))         options = odeset(options,$textcolor{mred}{'Events'},@(t,x) zeroevents(x,t,j,C,D,...             rule,nargC,nargD));         $textcolor{mgreen}{% Check if it is possible to flow from current position}         insideC = fun_wrap(xout(end,:).',tout(end),j,C,nargC);         $textcolor{mblue}{if} insideC == 1             $textcolor{mblue}{if} isDAE                 options = odeset(options,$textcolor{mred}{'InitialSlope'},f(xout(end,:).',tout(end)));             $textcolor{mblue}{end}             [t,x] = odeX(@(t,x) fun_wrap(x,t,j,f,nargf),[tout(end) tfinal],...                 xout(end,:).', $textcolor{mred}{options);}             nt = length(t);             tout = [tout; t];             xout = [xout; x];             jout = [jout; j*ones(1,nt)'];         $textcolor{mblue}{end}                  $textcolor{mgreen}{%Check if it is possible to jump}         insideD = fun_wrap(xout(end,:).',tout(end),j,D,nargD);         $textcolor{mblue}{if} insideD == 0             break;         $textcolor{mblue}{else}             $textcolor{mblue}{if} rule == 1                 $textcolor{mblue}{while} (j<JSPAN(end))                     $textcolor{mgreen}{% Check if it is possible to jump from current position}                     insideD = fun_wrap(xout(end,:).',tout(end),j,D,nargD);                     $textcolor{mblue}{if} insideD == 1                         [j $textcolor{mred}{tout jout xout] = jump(g,j,tout,jout,xout,nargg);}                     $textcolor{mblue}{else}                         break;                     $textcolor{mblue}{end}                 $textcolor{mblue}{end}             $textcolor{mblue}{else}                 [j $textcolor{mred}{tout jout xout] = jump(g,j,tout,jout,xout,nargg);}             $textcolor{mblue}{end}         $textcolor{mblue}{end}         fprintf($textcolor{mred}{'\b\b\b\b%3.0f%%'},max(100*j/JSPAN(end),100*tout(end)/TSPAN(end)));     $textcolor{mblue}{end}     t = tout;     x = xout;     j = jout;     fprintf($textcolor{mred}{'\nDone\n'});     $textcolor{mblue}{end}       
\end{Verbatim}  
  
\UndefineShortVerb{\$} 
\UndefineShortVerb{\#} 
 